<template>
  <div class="wrapper">
    <div class="d-flex justify-center">
      <check-vulnerability-component
        :vulnerability="vulnerability"
      ></check-vulnerability-component>
    </div>
    <v-btn
      v-if="researchGropup"
      @click="navigateToCompareView(researchGropup)"
      color="purple-lighten-3"
      class="comare-button"
      variant="text"
      size="x-large"
      >compare to others</v-btn
    >
  </div>
</template>
  
  <script>
import jsonpath from "jsonpath";

import { ref, computed, onMounted, defineComponent } from "vue";
import { useRouter } from "vue-router";
import { useStore } from "vuex";
import CheckVulnerabilityComponent from "@/components/CheckVulnerabilityComponent.vue";

export default defineComponent({
  name: "check-vulnerability-view",
  components: {
    CheckVulnerabilityComponent,
  },
  props: {
    vulnerability: {
      type: String,
      required: true,
    },
  },
  setup(props) {
    const store = useStore();

    const router = useRouter();
    const vulnerabilityConfig = ref({});
    const researchGropup = ref("");

    onMounted(async () => {
      await store.dispatch("loadSwaggerData");
      const swagger = computed(() => store.state.swaggerData);
      vulnerabilityConfig.value = getVulnerabilityConfig(swagger);
      researchGropup.value = getReaserchGroup(vulnerabilityConfig.value);
    });

    const getVulnerabilityConfig = (swagger) => {
      const vulnerabilityConfig = {
        ...swagger.value.paths.filter((x) => x.path === props.vulnerability)[0],
      };
      return vulnerabilityConfig;
    };
    const getReaserchGroup = (vulnerabilityConfig) => {
      const summary =
        jsonpath.query(vulnerabilityConfig, `$..summary`)[0] || "";
      return summary;
    };
    // navigate to the compare view
    const navigateToCompareView = (researchGropup) => {
      router.push({
        name: "research-compare-view",
        params: { researchGroup: researchGropup },
      });
    };
    return { navigateToCompareView, researchGropup };
  },
});
</script>
  
  <style scoped>
.wrapper {
  width: 100%;
  margin: 0 auto;
}
.comare-button {
  display: block;
  margin: 20px auto;
}
</style>